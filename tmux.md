<font size = 5>

# 说明
在官方git上对[tmux](https://github.com/tmux/tmux)的描述基本没有, 了解tmux的途径有:
1. 网上视频教学, 这个在youtube或b站上都能找到
2. tmux手册. 官方明确指出tmux手册可以使用源码构建, 即在源码下键入`nroff -mdoc tmux.1 | less`. 这其实是在制作man手册. 所以通过源码安装的tmux有可以在第1章查看到tmux的所有功能
3. 包管理器下载, 如Homebrew, 下载好的tmux包中已经制作好了手册, 并且可以直接`man tmux`查看到

# 安装
笔者还是选择直接用homebrew来安装`brew install tmux`


# 简介
tmux是一个多路复用器: 它允许从单个屏幕创建,访问和控制多个终端. tmux可以与屏幕分离并继续在后台运行,然后重新连接. 举例来说: 如在一个桌面终端程序(<font color = red>伪终端</font>)上ssh一个远程主机, 当桌面终端程序关闭后, 它对应的ssh会话也结束了. 但若在tmux环境下ssh一个远程主机, tmux的机制会将ssh与窗口分离, 维护在后台, 当需要时再重新连上窗口. 这就是tmux大致的工作机制. 实际上tmux管理了很多类似ssh一样的进程. 底层原理是Unix下的伪终端技术, 笔者这里不讨论

以桌面应用程序的伪终端来说, 如Alacritty. 当以下面方式启动tmux:

1. 直接在命令行键入`tmux`
2. 直接在命令行键入`tmux new-session`

此刻其实有至少有:

1. 桌面操作系统
2. Alacritty窗口进程, 也可称为伪终端
3. shell, 笔者这里是zsh
4. tmux, 事实上tmux的架构中至少还有个守护进程和1个tumx客户进程

tmux会自动创建一个会话, 并关联到窗口显示到屏幕上. 这些是man手册的文档, 实际上这里的过程和Unix的伪终端技术有关, 非常复杂. 这里直接简单理解就行了 

在tmux中3大概念:
1. 会话: session
2. 窗口: window
3. 面板: pane

同样的, 这里涉及到伪终端的技术, 不讨论. 它们之前的关系:一个session可以有多个window, 一个window可以有多个pane, 每个pane本质是伪终端.


每个session是持久的, 即使断开也能继续存在, 这得意于tmux的守护进程(daemon), 它管理着所有的session. 可以通过`tmux attach`重新连接. 在tmux中session由client负责渲染到屏幕上, session由tmux-daemon管理, session和client通过socket通信, 这个socket是临时的, 位于`/tmp`下. 也就是说在打开tmux后, 可以通过在命令行输入tmux规定的命令和tmux-daemon通信.

选项如下:

|选项|说明|涉及选项|
|:-|:-|:-|
|`-2`|强制tmux支持256颜色模式, 相当于`-T 256`||
|`-C`|启用控制模式(见后面的章节)||
|`--shell-command`或`-c`|使用默认的shell执行shell命令|`default-shell`: 若配置该选项则使用这个shell|
|`-D`|不要将tmux作为守护进程启动|`exit-empty`|
|`-N`|禁止启动tmux-daemon||
|`--socket-path`或`-S`|自定义socket的路径, 将忽略默认的目录(`TMUX_TMPDIR` 或 `/tmp`), 同时忽略任何`-L`标志||
|`-V`|打印出版本号||
|`-v`|创建相应的日志文件||


上述这些选项是启动tmux时可以指定的. 还有其他选项可以参考man手册


<br/>


# 系统的快捷键
### 系统命令
|命令|说明|
|:-|:-|
|?|列出所有绑定的key|
|d|断开当前会话|
|D|选择要断开的会话|
|`Ctrl-z`|挂起当前会话|
|r|强制重载当前客户端|
|s|查看会话列表|
|:|命令模式, 可以输入如ls的命令|
|[|复制模式, q退出|
|]|粘贴复制模式中的文本|
|~|列出提示信息的缓存|
|(|将连接的客户端切换到上一个会话|
|)|将连接的客户端切换到下一个会话|
|L|将连接的客户端切换到上一个会话|
|t|显示时钟|


### 窗口(window)命令
|命令|说明|
|:-|:-|
|c|新建窗口|
|,|当前窗口重命名|
|0~9|切换指定窗口|
|p|切换上个窗口|
|n|切换下个窗口|
|w|打开窗口列表,选择切换|
|.|修改窗口编号, 适于窗口重新排序|
|f|快速定位窗口(输入关键字匹配名称)|
|i|显示当前窗口的一些信息|
|l|移动到上一个选中的窗口|
|&|关闭当前窗口, 会提示确认(y or n)|


### 面板(pane)命令
|命令|说明|
|:-|:-|
|`"`|垂直分|
|`%`|水平分|
|x|关闭当前面板|
|z|最大化,再执行一次则恢复|
|!|当前面板移动到新的窗口打开, 当前窗口必须有1个以上的面板|
|;|切换到最后一次使用的面板|
|q|选择面板. 需要键入面板的编号|
|m|标记当前的面板|
|M|取消标记的面板|
|o|选择下个面板|
|{|当前面板向前换|
|}|当前面板向后换|
|`Ctrl + O`|顺时针旋转当前窗口中的所有面板|
|方向键|移动光标切换面板|
|Space|循环下个面板一直往后切换|
|`Alt+方向`|大幅调整当前面板的尺寸|
|`Ctrl+方向`|小幅调整当前面板的尺寸,Mac下被系统事件屏蔽了|
|`Alt+(1到5)`|排列面板: 等距水平, 等距垂直,主水平,主垂直,平铺|


### buffter相关
|命令|说明|
|:-|:-|
|`[`|进入复制模式,可以查看文本或查看历史记录|
|`]`|粘贴最新的buffer的文本|





# 会话
### 新建会话
创建会话有2种:
```bash
#  匿名的会话
tmux

# 创建会话, 名称为demo
tmux new -s demo
```

--- 




<br/>


### 断开会话
断开会话并不是关闭会话, 后期可以恢复的.

```bash
# 断开当前会话, 会话会在服务器被保存现场
tmux detach 
```

> 可以使用快捷键`Ctrl+b`先切换到命令模式, 再摁下`d`就可以断开当前会话


<br/>

### 进入之前的会话
```bash
tmux attach-session -t session_name     # 进入指定会话
tmux a -t session_name                  # 同上
tmux a                                  # 默认进入到第1个会话
```

<br/>

### 关闭会话
关闭的操作前缀都是`kill-`,因为涉及到4种tmux的概念, 所以:
1. `kill-server`: tmux后台有缓存机制, 当修改配置文件后, 必须关闭这个服务器, 不然没有作用
2. `kill-session` 
3. `kill-window`
4. `kill-pane`

```bash
tmux kill-session -t demo       # 关闭demo会话
tmux kill-server                # 关闭服务器, 所有的会话将消失
```

<br/>

### 查看所有会话
有3种场景查询:
1. 当前终端没有运行tmux,但系统中有其他终端运行了tmux
2. 当前已经在tmux环境中
3. 当前在tmux环境中使用快捷键
```bash
tmux list-session
tmux ls
``` 
---



> 也可以在当前会话中使用快捷键`ctrl + b`后再摁下`s`

---


> 在界面中的上部分可以通过上下键进行选择, 左右键是展开, 然后Enter键确认. 按`q`退出


<br/>

# tmux快捷键
### 命令原则
tmux所有的快捷键必须包含一个前缀<font color = red>Ctrl + B</font>, 后续再键入命令. 这有点像vim的模式触发



# 配置
### 配置文件
tmux的用户级配置文件为`~/.tmux.conf`, 没有的话就创建. 配置生效的方法:
1. restart tmux
2. 在tmux环境下进入命令模式(`前缀(如Ctrl+B) + :`, 键入`source-file ~/.tmux.conf`

```conf

```

















</font>
